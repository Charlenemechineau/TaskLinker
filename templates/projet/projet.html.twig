{# templates/projet/projet.html.twig #}

{% extends 'base.html.twig' %}

{# titre de l’onglet du navigateur #}
{% block title %}{{ projet.titre }} - TaskLinker{% endblock %}

{# titre dans le header de la page #}
{% block page_title %}{{ projet.titre }}{% endblock %}

{% block body %}

      <div class="flex-header">
         <div class="user-list">
            {# ici j’affiche les membres du projet
               j’utilise first pour prendre la première lettre
               et upper pour la passer en majuscule #}
            {% for employe in projet.employes %}
               <div class="avatar">
                  {{ employe.prenom|first|upper }}{{ employe.nom|first|upper }}
               </div>
            {% else %}
               <p>Aucun membre associé.</p>
            {% endfor %}
         </div>

         {# bouton pour modifier le projet #}
         <a class="button" href="{{ path('app_project_edit', { id: projet.id }) }}">
            Modifier
         </a>
      </div>

      <div id="tasks-container">

      {# ----- Colonne To Do ----- #}
         <div class="task-column">
            <h2>To Do</h2>
            <div class="tasks-list">

               {# je parcours toutes les tâches avec le statut "todo" #}
               {% for tache in tachesTodo %}
                     <a class="task" href="{{ path('app_tache_edit', { id: tache.id }) }}">
                        <h3>{{ tache.titre }}</h3>

                        {# description uniquement si elle existe #}
                        {% if tache.description %}
                           <p>{{ tache.description }}</p>
                        {% endif %}

                        <div class="task-infos">
                           {# date d’échéance si elle est renseignée #}
                           {% if tache.dateEcheance %}
                              <div class="task-deadline">
                                 <i class="fa-regular fa-calendar"></i>
                                 {{ tache.dateEcheance|date('d/m/Y') }}
                              </div>
                           {% endif %}

                           {# initiales de l’employé assigné #}
                           {% if tache.employeAssigne %}
                              <div class="mini-user">
                                 {{ tache.employeAssigne.prenom|first|upper }}{{ tache.employeAssigne.nom|first|upper }}
                              </div>
                           {% endif %}
                        </div>
                     </a>
               {% else %}
                     <p>Aucune tâche pour l’instant.</p>
               {% endfor %}

               {# lien pour ajouter une nouvelle tâche dans cette colonne #}
               <a href="{{ path('app_tache_new', { id: projet.id }) }}" class="task-add">+ Ajouter une tâche</a>
            </div>
         </div>

         {# ----- Colonne Doing ----- #}
         <div class="task-column">
            <h2>Doing</h2>
            <div class="tasks-list">

               {# ici ce sont les tâches en cours (statut "doing") #}
               {% for tache in tachesDoing %}
                  <a class="task" href="{{ path('app_tache_edit', { id: tache.id }) }}">
                        <h3>{{ tache.titre }}</h3>

                        {% if tache.description %}
                           <p>{{ tache.description }}</p>
                        {% endif %}

                        <div class="task-infos">
                           {% if tache.dateEcheance %}
                              <div class="task-deadline">
                                    <i class="fa-regular fa-calendar"></i>
                                    {{ tache.dateEcheance|date('d/m/Y') }}
                              </div>
                           {% endif %}

                           {% if tache.employeAssigne %}
                              <div class="mini-user">
                                    {{ tache.employeAssigne.prenom|first|upper }}{{ tache.employeAssigne.nom|first|upper }}
                              </div>
                           {% endif %}
                        </div>
                  </a>
               {% else %}
                     <p>Aucune tâche en cours.</p>
               {% endfor %}

               <a href="{{ path('app_tache_new', { id: projet.id }) }}" class="task-add">+ Ajouter une tâche</a>
            </div>
         </div>

         {# ----- Colonne Done ----- #}
         <div class="task-column">
            <h2>Done</h2>
            <div class="tasks-list">

               {# ici les tâches terminées (statut "done") #}
               {% for tache in tachesDone %}
                  <a class="task" href="{{ path('app_tache_edit', { id: tache.id }) }}">
                        <h3>{{ tache.titre }}</h3>

                        {% if tache.description %}
                           <p>{{ tache.description }}</p>
                        {% endif %}

                        <div class="task-infos">
                           {% if tache.dateEcheance %}
                              <div class="task-deadline">
                                    <i class="fa-regular fa-calendar"></i>
                                    {{ tache.dateEcheance|date('d/m/Y') }}
                              </div>
                           {% endif %}

                           {% if tache.employeAssigne %}
                              <div class="mini-user">
                                    {{ tache.employeAssigne.prenom|first|upper }}{{ tache.employeAssigne.nom|first|upper }}
                              </div>
                           {% endif %}
                        </div>
                  </a>
               {% else %}
                  <p>Aucune tâche terminée.</p>
               {% endfor %}

               <a href="{{ path('app_tache_new', { id: projet.id }) }}" class="task-add">+ Ajouter une tâche</a>
            </div>
         </div>

      </div>

{% endblock %}